first let's understand the flow of the functiinality and then fix that. becasue right now we are creating a riddle that steps happens one after the other and it is important to make sure everything happens at its right time and place. so go read the sourcecode and understadn the sequence of actions that happen and then bring a report to me.